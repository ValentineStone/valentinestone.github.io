<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="bootstrap.min.css">

<script src="grid.js"></script>
<script src="version.js"></script>
<script src="detector.js"></script>
<script src="formatinf.js"></script>
<script src="errorlevel.js"></script>
<script src="bitmat.js"></script>
<script src="datablock.js"></script>
<script src="bmparser.js"></script>
<script src="datamask.js"></script>
<script src="rsdecoder.js"></script>
<script src="gf256poly.js"></script>
<script src="gf256.js"></script>
<script src="decoder.js"></script>
<script src="qrcode.js"></script>
<script src="findpat.js"></script>
<script src="alignpat.js"></script>
<script src="databr.js"></script>

<style>
	.alert {
		display: block
	}
</style>

<label id="order-label" class="alert alert-primary">
	Order:
	<input id="order" type="file" accept="image/*" capture="camera" onchange="onFileSelected(this)">
</label>
<label id="drone-label" class="alert alert-primary">
	Drone:
	<input id="drone" type="file" accept="image/*" capture="camera" onchange="onFileSelected(this)">
</label>

<button type="button" style="display:none" class="btn btn-primary btn-lg btn-block">Deliver</button>

<hr />

VERSION wow

<script>
	var drone_data = undefined
	var order_data = undefined
	function $(selector, parent) {
		return (parent === undefined ? document : parent).querySelector(selector)
	}
	function callback(input) {
		var label = document.getElementById(input.id + '-label')
		return function callback(value) {
			try {
				if (value instanceof Error) throw value
				var parsed = JSON.parse(value)
				if (input.id === 'drone')
					drone_data = parsed
				else
					order_data = parsed
				if (drone_data && order_data)
					document.querySelector('button').style = ''
			} catch (e) {
				alert(e)
				label.className = 'alert alert-danger'
			}
		}
	}
	function onFileSelected(input) {
		try {
			for (var i = 0; i < input.files.length; i++) {
				var file = input.files[i]
				var url = URL.createObjectURL(file)
				qrcode.callback = callback(input)
				qrcode.decode(url)
			}
		} catch (e) { alert(e) }
	}
</script>